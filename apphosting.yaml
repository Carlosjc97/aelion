runtime: nodejs20

# Deja que App Hosting use su builder nativo. (Quitamos el bloque 'build')
# build:
#   builder: heroku/builder:22

runConfig:
  entrypoint: node server/server.js
  cpu: 1
  memoryMiB: 512
  minInstances: 0
  maxInstances: 10
  concurrency: 80

env:
  # Usa 'variable' en lugar de 'name'
  # Limita ambas a RUNTIME para que NO se escriban durante BUILD
  - variable: PORT
    value: "8080"
    availability:
      - RUNTIME

  - variable: OPENAI_API_KEY
    secret: OPENAI_API_KEY
    availability:
      - RUNTIME

  - variable: NODE_ENV
    value: production
    availability:
      - RUNTIME
